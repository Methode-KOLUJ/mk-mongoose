let Titre=document.querySelector("header h1").textContent,currentQuestionIndex=(console.log(Titre),0),score=0,username="",password_student="";function Chante(){var e=new Audio;e.src="../../../Z.mp3",e.play()}function shuffleQuestions(t){for(let e=t.length-1;0<e;e--){var n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function afficherQuestion(){let e=document.getElementById("question"),o=document.getElementById("options");document.getElementById("question-position").textContent=currentQuestionIndex+1;var t=questions[currentQuestionIndex];e.textContent=t.question,o.innerHTML="",t.options.forEach((e,t)=>{var n=document.createElement("div");n.innerHTML=`<input type="radio" id="option${t}" name="answer" value="${e}">
                               <label for="option${t}">${e}</label>`,o.appendChild(n)});let n=document.querySelectorAll('input[type="radio"]');n.forEach(e=>{e.addEventListener("click",function(){n.forEach(e=>{e.disabled=!0}),this.disabled=!1})}),t.link&&InjecterLien(t.link.text,t.link.url)}function verifierReponse(){var e,t=document.querySelector('input[name="answer"]:checked');t?(t.value===questions[currentQuestionIndex].answer&&(Chante(),score++),currentQuestionIndex++,document.getElementById("current-score").textContent=score,t=document.getElementById("progress-percentage"),document.getElementById("total-questions").textContent=questions.length,e=(score/questions.length*100).toFixed(2),t.textContent=e+"%",(currentQuestionIndex<questions.length?afficherQuestion:afficherResultat)()):alert(username+", sélectionne une réponse avant de valider.")}function afficherResultat(){document.getElementById("game-content").innerHTML=`<h6>${username}</h6> <h3>Entraînez-vous très souvent !</h3>`,document.getElementById("question-position").style.visibility="hidden",document.getElementById("restart-button").style.display="block",document.querySelector(".position").style.visibility="hidden";var e=document.querySelector(".JokerName"),t=document.querySelector(".JokerID");e.textContent="",t.style.display="none"}let submitButton=document.getElementById("submit-button"),restartButton=(submitButton.addEventListener("click",verifierReponse),submitButton.addEventListener("click",function(){}),shuffleQuestions(questions),afficherQuestion(),document.getElementById("restart-button"));function afficherModal(){0===score&&(document.getElementById("myModal").style.display="block",document.querySelector("header").style.display="none")}restartButton.addEventListener("click",()=>{sendScoreToServer(document.getElementById("username").value,document.querySelector("header h1").textContent,parseInt(document.getElementById("current-score").textContent),document.getElementById("progress-percentage").textContent),setTimeout(()=>{location.reload()},500)}),restartButton.classList.add("Recommencer"),restartButton.addEventListener("mouseenter",function(){restartButton.classList.toggle("Recom-hover")}),setTimeout(afficherModal,30),document.getElementById("userForm").addEventListener("submit",function(e){e.preventDefault();let t=document.getElementById("username").value;e=document.getElementById("password_student").value,/^[A-Z _-]+$/.test(t)?fetch("/validate-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password_student:e})}).then(e=>e.json()).then(e=>{e.valid?(document.getElementById("myModal").style.display="none",document.querySelector("header").style.display="block",document.querySelector(".JokerName").textContent=t,console.log("Nom d'utilisateur:",t)):alert("Nom d'utilisateur ou mot de passe incorrect !")}).catch(e=>{console.error("Erreur:",e)}):alert("Lettres majuscules, tirets, underscores et espaces sont les seules acceptés")});let toggleButton=document.getElementById("toggle-button");function InjecterLien(e,t){var n=document.getElementById("question"),o=document.createElement("a");o.href="#",o.textContent=e,o.addEventListener("click",function(e){e.preventDefault(),afficherImageEnSuperposition(t)}),o.style.display="block",n.appendChild(o)}function afficherImageEnSuperposition(e){let t=document.getElementById("overlay");document.getElementById("overlay-image").src=e,t.style.display="block",document.getElementById("close-button").addEventListener("click",function(){t.style.display="none"})}function sendScoreToServer(e,t,n,o){var r=new Date;saveScoreToDatabase(e,t,n,o,formatDate(r),r.toTimeString().split(" ")[0])}function formatDate(e){return["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][e.getDay()]+` ${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-`+e.getFullYear()}function saveScoreToDatabase(e,t,n,o,r,s){fetch("/save-score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,Titre:t,score:n,progressPercentage:o,submissionDate:r,submissionTime:s})}).then(e=>e.json()).then(e=>{console.log("Score saved:",e)}).catch(e=>{console.error("Error saving score:",e)})}toggleButton.addEventListener("click",function(){document.getElementById("sidebar").classList.toggle("show")}),document.addEventListener("click",function(e){var t=document.getElementById("sidebar"),n=document.getElementById("toggle-button"),o=t.contains(e.target),n=n.contains(e.target);o||n||t.classList.remove("show")}),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){document.getElementById("loader-wrapper").style.display="none",document.getElementById("content").classList.add("loaded")},6938)});